{"version":3,"sources":["gallery.coffee"],"names":[],"mappings":";AAAA;;AAAA,IAAG,MAAM,CAAC,QAAV;AAEE,SAAO,CAAC,GAAR,CAAY,4BAAZ;AAAA,EACA,MAAM,CAAC,SAAP,CAAiB,aAAjB,CADA;AAAA,EAGA,UAAU,IAHV;AAAA,EAIA,OAAO,CAAC,OAAR,CAAgB;AACd,WAAO,CAAC,GAAR,CAAY,gBAAZ;AACA,QAAG,WAAW,CAAC,OAAZ,EAAH;AACE,UAAG,OAAH;AACE,eAAO,CAAC,GAAR,CAAY,yBAAZ,EAAuC,WAAW,CAAC,OAAZ,EAAqB,CAAC,GAA7D;eACA,UAAU,MAFZ;OADF;KAFc;EAAA,CAAhB,CAJA;AAAA,EAWA,OAAO,CAAC,OAAR,CAAgB;AACd,QAAG,WAAW,CAAC,OAAZ,EAAH;AACE,aAAO,CAAC,GAAR,CAAY,iBAAZ;AAAA,MACA,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,WAAW,CAAC,OAAZ,CAAoB;AAAA,QAAC,OAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAR;OAApB,CAAoE,CAAC,IAAK,GAA/G,CADA;aAGA,OAAO,CAAC,gBAAR,GAJF;KADc;EAAA,CAAhB,CAXA;AAAA,EAmBA,QAAQ,CAAC,cAAT,CAAwB,uBAAxB,EAAiD;WAC/C,WAAW,CAAC,IAAZ,CAAiB,EAAjB,EAAqB;AAAA,MAAC,MAAM;AAAA,QAAC,OAAO,CAAR;OAAP;KAArB,EAD+C;EAAA,CAAjD,CAnBA;AAAA,EAsBA,QAAQ,CAAC,cAAT,CAAwB,yBAAxB,EAAmD;AACjD,QAAG,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAH;AACE,aAAO,CAAC,GAAR,CAAY,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAZ;aACA,WAAW,CAAC,OAAZ,CAAoB;AAAA,eAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAP;OAApB,EAFF;KADiD;EAAA,CAAnD,CAtBA;AAAA,EA4BA,QAAQ,CAAC,cAAT,CAAwB,uBAAxB,EAAiD;AAC/C,MAAE,OAAF,CAAU,CAAC,IAAX,CAAgB,KAAhB,EAAuB,kDAAkD,OAAO,CAAC,GAAR,CAAY,uBAAZ,CAAzE,CAA8G,CAAC,EAA/G,CAAkH,MAAlH,EAA0H;AACxH,QAAE,WAAF,CAAc,CAAC,IAAf,CAAoB,oBAApB,CAAyC,CAAC,WAA1C,CAAsD,UAAtD;aACA,EAAE,gBAAF,CAAmB,CAAC,QAApB,CAA6B,UAA7B,EAFwH;IAAA,CAA1H;WAGA,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAJ+C;EAAA,CAAjD,CA5BA;AAAA,EAkCA,QAAQ,CAAC,cAAT,CAAwB,qBAAxB,EAA+C,SAAC,GAAD;AAC7C,QAAG,GAAH;aACE,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAe,GAAf,GAAoB,SAApB,GAAgC,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAe,IADjD;KAD6C;EAAA,CAA/C,CAlCA;AAAA,EAsCA,QAAQ,CAAC,cAAT,CAAwB,kBAAxB,EAA4C,SAAC,IAAD;AAC1C;AAAA,UAAM,CAAC,CAAC,KAAF,CAAQ,IAAR,CAAN;WACA,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAe,GAAf,GAAoB,SAApB,GAAgC,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAe,IAFL;EAAA,CAA5C,CAtCA;AAAA,EA6CA,MAAM,CAAC,OAAP,CAAe;AAEb,MAAE,MAAF,CAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,6BAAtB,EAAqD,SAAC,CAAD;AACnD;AAAA,aAAO,CAAC,GAAR,CAAY,gBAAZ;AACA,UAAG,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,sBAAxB,MAAqD,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAxD;AACE,iBAAS,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,sBAAxB,CAAT;AAAA,QACA,OAAO,CAAC,GAAR,CAAY,MAAZ,CADA;AAAA,QAEA,EAAE,WAAF,CAAc,CAAC,IAAf,CAAoB,oBAApB,CAAyC,CAAC,QAA1C,CAAmD,UAAnD,CAFA;AAAA,QAGA,EAAE,gBAAF,CAAmB,CAAC,WAApB,CAAgC,UAAhC,CAHA;eAIA,OAAO,CAAC,GAAR,CAAY,yBAAZ,EAAuC,MAAvC,EALF;OAAA;eAOE,CAAC,CAAC,QAAF,CAAW,gBAAX,EAA6B,GAA7B,EAAkC;AAAA,UAAC,QAAQ,GAAT;SAAlC,EAPF;OAFmD;IAAA,CAArD;AAAA,IAYA,EAAE,MAAF,CAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,6BAAtB,EAAqD;AAEnD,aAAO,CAAC,GAAR,CAAY,wBAAZ;AAEA,UAAG,OAAO,CAAC,gBAAX;eACE,EAAE,mBAAF,CAAsB,CAAC,QAAvB,CAAgC,SAAhC,EADF;OAAA;eAGE,OAAO,CAAC,gBAAR,GAA2B,KAAK,CAAC,cAAN,CAAqB,QAAQ,CAAC,gBAA9B,EAAgD;AAAA,UAAC,UAAU,WAAW,CAAC,IAAZ,CAAiB,EAAjB,EAAqB;AAAA,YAAC,MAAM;AAAA,cAAC,OAAO,CAAR;aAAP;WAArB,CAAX;SAAhD,EAAuG,QAAQ,CAAC,IAAhH,EAH7B;OAJmD;IAAA,CAArD,CAZA;AAAA,IAqBA,EAAE,MAAF,CAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,2BAAtB,EAAmD,SAAC,CAAD;AACjD;AAAA,aAAO,CAAC,GAAR,CAAY,cAAZ;AACA,UAAG,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,oBAAxB,MAAmD,OAAO,CAAC,GAAR,CAAY,uBAAZ,CAAtD;AACE,iBAAS,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,oBAAxB,CAAT;AAAA,QACA,OAAO,CAAC,GAAR,CAAY,MAAZ,CADA;AAAA,QAEA,EAAE,WAAF,CAAc,CAAC,IAAf,CAAoB,oBAApB,CAAyC,CAAC,QAA1C,CAAmD,UAAnD,CAFA;AAAA,QAGA,EAAE,gBAAF,CAAmB,CAAC,WAApB,CAAgC,UAAhC,CAHA;AAAA,QAIA,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,MAArC,CAJA;eAKA,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,QAAnB,CAA4B,SAA5B,CAAsC,CAAC,QAAvC,EAAiD,CAAC,WAAlD,CAA8D,SAA9D,EANF;OAFiD;IAAA,CAAnD,CArBA;AAAA,IA+BA,EAAE,MAAF,CAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,qBAAtB,EAA6C;AAC3C;AAAA,eAAS,WAAW,CAAC,OAAZ,CAAoB;AAAA,eAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAP;OAApB,CAAkE,CAAC,IAAI,CAAC,MAAjF;AAAA,MACA,EAAE,WAAF,CAAc,CAAC,IAAf,CAAoB,oBAApB,CAAyC,CAAC,QAA1C,CAAmD,UAAnD,CADA;AAAA,MAEA,EAAE,gBAAF,CAAmB,CAAC,WAApB,CAAgC,UAAhC,CAFA;AAAA,MAGA,WAAc;AACZ;AAAA,YAAG,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,MAA7C,GAAsD,CAAzD;AACE,kBAAQ,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,KAA7C,EAAR;AACA,cAAG,QAAQ,CAAR,IAAa,MAAhB;AACE,cAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,WAA7C,CAAyD,SAAzD;AAAA,YACA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,CAAoC,CAAC,KAArC,EAA4C,CAAC,QAA7C,CAAsD,SAAtD,CADA;mBAEA,EAHF;WAAA;AAKE,oBAAQ,CAAR;AAAA,YACA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,WAA7C,CAAyD,SAAzD,CAAmE,CAAC,IAApE,EAA0E,CAAC,QAA3E,CAAoF,SAApF,CADA;mBAEA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,KAA7C,GAPF;WAFF;SAAA;AAWE,YAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,CAAoC,CAAC,KAArC,EAA4C,CAAC,IAA7C,EAAmD,CAAC,QAApD,CAA6D,SAA7D;iBACA,EAZF;SADY;MAAA,EAAH,EAHX;aAiBA,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,WAAW,CAAC,OAAZ,CAAoB;AAAA,eAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAP;OAApB,CAAkE,CAAC,IAAK,UAA7G,EAlB2C;IAAA,CAA7C,CA/BA;WAmDA,EAAE,MAAF,CAAS,CAAC,EAAV,CAAa,OAAb,EAAsB,qBAAtB,EAA6C;AAC3C;AAAA,eAAS,WAAW,CAAC,OAAZ,CAAoB;AAAA,eAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAP;OAApB,CAAkE,CAAC,IAAI,CAAC,MAAjF;AAAA,MACA,EAAE,WAAF,CAAc,CAAC,IAAf,CAAoB,oBAApB,CAAyC,CAAC,QAA1C,CAAmD,UAAnD,CADA;AAAA,MAEA,EAAE,gBAAF,CAAmB,CAAC,WAApB,CAAgC,UAAhC,CAFA;AAAA,MAGA,WAAc;AACZ;AAAA,YAAG,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,MAA7C,GAAsD,CAAzD;AACE,kBAAQ,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,KAA7C,EAAR;AACA,cAAG,QAAQ,CAAR,GAAY,CAAf;AACE,cAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,WAA7C,CAAyD,SAAzD;AAAA,YACA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,CAAoC,CAAC,IAArC,EAA2C,CAAC,QAA5C,CAAqD,SAArD,CADA;mBAEA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,CAAoC,CAAC,IAArC,EAA2C,CAAC,KAA5C,GAHF;WAAA;AAKE,oBAAQ,CAAR;AAAA,YACA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,WAA7C,CAAyD,SAAzD,CAAmE,CAAC,IAApE,EAA0E,CAAC,QAA3E,CAAoF,SAApF,CADA;mBAEA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,aAA9B,CAA4C,CAAC,KAA7C,GAPF;WAFF;SAAA;AAWE,YAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,CAAoC,CAAC,IAArC,EAA2C,CAAC,QAA5C,CAAqD,SAArD;iBACA,EAAE,qBAAF,CAAwB,CAAC,IAAzB,CAA8B,KAA9B,CAAoC,CAAC,IAArC,EAA2C,CAAC,KAA5C,GAZF;SADY;MAAA,EAAH,EAHX;aAiBA,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,WAAW,CAAC,OAAZ,CAAoB;AAAA,eAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAP;OAApB,CAAkE,CAAC,IAAK,UAA7G,EAlB2C;IAAA,CAA7C,EArDa;EAAA,CAAf,CA7CA;AAAA,EAuHA,QAAQ,CAAC,gBAAgB,CAAC,MAA1B,CAAiC;AAAA,IAE/B,kBAAkB,SAAC,CAAD;AAChB;AAAA,WAAK,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,IAAnB,CAAwB,IAAxB,CAAL;AAAA,MACA,OAAO,CAAC,GAAR,CAAY,eAAZ,EAA6B,EAA7B,CADA;AAAA,MAEA,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,QAAnB,CAA4B,SAA5B,CAAsC,CAAC,QAAvC,EAAiD,CAAC,WAAlD,CAA8D,SAA9D,CAFA;AAGA,UAAG,OAAO,CAAC,qBAAX;AACE,aAAK,CAAC,MAAN,CAAa,OAAO,CAAC,qBAArB,EADF;OAHA;AAAA,MAKA,OAAO,CAAC,GAAR,CAAY,WAAW,CAAC,OAAZ,CAAoB;AAAA,QAAC,KAAK,EAAN;OAApB,CAAZ,CALA;aAMA,OAAO,CAAC,qBAAR,GAAgC,KAAK,CAAC,cAAN,CAAqB,QAAQ,CAAC,qBAA9B,EAAqD,WAAW,CAAC,OAAZ,CAAoB;AAAA,QAAC,KAAK,EAAN;OAApB,CAArD,EAAqF,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,YAA5B,CAAyC,CAAC,GAA1C,CAA8C,CAA9C,CAArF,EAPhB;IAAA,CAFa;AAAA,IAW/B,0BAA0B,SAAC,CAAD;AACxB;AAAA,gBAAU,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,OAAZ,CAAoB,IAApB,CAAV;AAAA,MACA,KAAK,OAAO,CAAC,IAAR,CAAa,IAAb,CADL;AAAA,MAEA,SAAS,WAAW,CAAC,OAAZ,CAAoB;AAAA,QAAC,OAAO,EAAR;OAApB,CAAgC,CAAC,IAF1C;AAAA,MAGA,SAAS,MAAM,CAAC,GAAP,CAAW,SAAC,CAAD;eAClB,CAAC,CAAC,KAAF,CAAQ,GAAR,CAAa,GAAb,GAAkB,SAAlB,GAA8B,CAAC,CAAC,KAAF,CAAQ,GAAR,CAAa,IADzB;MAAA,CAAX,CAHT;AAAA,MAKA,SAAS,MAAM,CAAC,MAAP,CAAc,MAAd,CALT;AAAA,MAMA,QAAQ,SAAS,OAAO,CAAC,IAAR,CAAa,OAAb,CAAT,EAAgC,EAAhC,CANR;AAAA,MAOA,OAAO,CAAC,GAAR,CAAY,MAAZ,CAPA;aAQA,CAAK,YAAQ;AAAA,QACX,OAAO,uBADI;AAAA,QAEX,MAAM,uDAFK;AAAA,QAGX,MAAM,KAHK;AAAA,QAIX,UAAU,aAJC;AAAA,QAKX,SAAS;AAAA,UACP,SAAS,IADF;SALE;AAAA,QAQX,SAAS;AAAA,UACP,QAAQ,KADD;AAAA,UAEP,SAAS,KAFF;SARE;AAAA,QAYX,SAAS;AAAA,UACP,SAAS,KADF;SAZE;OAAR,CAAL,CAeG,CAAC,GAfJ,EAeS,CAAC,EAfV,CAea,iBAfb,EAegC;eAE9B,MAAM,CAAC,IAAP,CAAY,YAAZ,EAA0B,MAA1B,EAAkC,eAAlC,EAAmD,SAAC,GAAD,EAAM,GAAN;AACjD,cAAG,GAAH;mBAEE,IAAI,CAAC,MAAL,CAAY,8CAAZ,EAFF;WAAA;AAME,gBAAG,GAAH;AAEE,yBAAW,CAAC,MAAZ,CAAmB,EAAnB;AAAA,cACA,IAAI,CAAC,MAAL,CAAY,gBAAZ,CADA;AAAA,cAEA,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,OAAZ,CAAoB,IAApB,CAAyB,CAAC,IAA1B,CAA+B,IAA/B,CAAoC,CAAC,KAArC,EAA4C,CAAC,OAA7C,CAAqD,OAArD,CAFA;qBAIA,WAAW,CAAC,IAAZ,CAAiB;AAAA,gBAAC,OAAO;AAAA,kBAAC,KAAK,KAAN;iBAAR;eAAjB,CAAuC,CAAC,KAAxC,EAA+C,CAAC,OAAhD,CAAwD,SAAC,KAAD;AACtD;AAAA,2BAAW,KAAK,CAAC,KAAN,GAAc,CAAzB;AAAA,gBACA,KAAK,KAAK,CAAC,GADX;uBAEA,WAAW,CAAC,MAAZ,CAAmB,EAAnB,EAAuB;AAAA,kBAAC,MAAM;AAAA,oBAAC,OAAO,QAAR;mBAAP;iBAAvB,EAHsD;cAAA,CAAxD,EANF;aAAA;qBAaE,IAAI,CAAC,MAAL,CAAY,oDAAZ,EAbF;aANF;WADiD;QAAA,CAAnD,EAF8B;MAAA,CAfhC,CAuCC,CAAC,EAvCF,CAuCK,gBAvCL,EAuCuB;eACrB,OAAO,CAAC,GAAR,CAAY,mBAAZ,EADqB;MAAA,CAvCvB,EATwB;IAAA,CAXK;AAAA,IAgE/B,wBAAwB,SAAC,CAAD;AAEtB,iBAAW,CAAC,IAAZ,EAAkB,CAAC,KAAnB,EAA0B,CAAC,OAA3B,CAAmC,SAAC,KAAD;AACjC;AAAA,mBAAW,KAAK,CAAC,KAAN,GAAc,CAAzB;AAAA,QACA,OAAO,CAAC,GAAR,CAAY,QAAZ,CADA;eAEA,WAAW,CAAC,MAAZ,CAAmB,KAAK,CAAC,GAAzB,EAA8B;AAAA,UAAC,MAAM;AAAA,YAAC,OAAO,QAAR;WAAP;SAA9B,EAHiC;MAAA,CAAnC;aAKA,WAAW,CAAC,MAAZ,CAAmB;AAAA,QACjB,OAAO,CADU;AAAA,QAEjB,MAAM,EAFW;AAAA,QAGjB,OAAO,cAHU;AAAA,QAIjB,MAAM,kBAJW;AAAA,QAKjB,MAAM,IAAI,CAAC,KAAL,CAAe,UAAf,CALW;OAAnB,EAMG,SAAC,EAAD;eACD,MAAM,CAAC,UAAP,CAAkB;iBAChB,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,QAAZ,CAAqB,IAArB,CAA0B,CAAC,IAA3B,CAAgC,IAAhC,CAAqC,CAAC,KAAtC,EAA6C,CAAC,OAA9C,CAAsD,OAAtD,EADgB;QAAA,CAAlB,EAEE,GAFF,EADC;MAAA,CANH,EAPsB;IAAA,CAhEO;GAAjC,CAvHA;AAAA,EA2MA,QAAQ,CAAC,gBAAgB,CAAC,QAA1B,GAAqC;AAEnC,WAAO,CAAC,GAAR,CAAY,yBAAZ;WAEA,MAAM,CAAC,KAAP,CAAa;AAEX,QAAE,mBAAF,CAAsB,CAAC,QAAvB,CAAgC,SAAhC;AAAA,MAEA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,sBAA5B,CAAmD,CAAC,QAApD,CAA6D;AAAA,QAC3D,MAAM,SAAC,CAAD,EAAI,EAAJ;iBACJ,OAAO,CAAC,aAAR,GADI;QAAA,CADqD;OAA7D,CAFA;aAOA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,sBAA5B,CAAmD,CAAC,IAApD,CAAyD,IAAzD,CAA8D,CAAC,KAA/D,EAAsE,CAAC,OAAvE,CAA+E,OAA/E,EATW;IAAA,CAAb,EAJmC;EAAA,CA3MrC;AAAA,EA2NA,QAAQ,CAAC,qBAAqB,CAAC,QAA/B,GAA0C;WAExC,EAAE,uBAAF,CAA0B,CAAC,QAA3B,CAAoC;AAAA,MAClC,MAAM,SAAC,CAAD,EAAI,EAAJ;eACJ,OAAO,CAAC,WAAR,GADI;MAAA,CAD4B;KAApC,EAFwC;EAAA,CA3N1C;AAAA,EAmOA,QAAQ,CAAC,qBAAqB,CAAC,OAA/B,CAAuC;AAAA,IAErC,UAAU,SAAC,GAAD;aAER,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAe,GAAf,GAAoB,SAApB,GAAgC,GAAG,CAAC,KAAJ,CAAU,GAAV,CAAe,IAFvC;IAAA,CAF2B;GAAvC,CAnOA;AAAA,EA2OA,QAAQ,CAAC,qBAAqB,CAAC,MAA/B,CAAsC;AAAA,IAEpC,kCAAkC,SAAC,CAAD;AAChC;AAAA,aAAO,CAAC,GAAR,CAAY,kBAAZ;AAAA,MACA,QAAQ,EAAE,CAAC,CAAC,MAAJ,CADR;AAAA,MAEA,OAAO,KAAK,CAAC,GAAN,CAAU,CAAV,CAAY,CAAC,KAAM,GAF1B;AAAA,MAGA,OAAO,CAAC,GAAR,CAAY,KAAK,CAAC,GAAN,CAAU,CAAV,CAAY,CAAC,KAAM,GAA/B,CAHA;AAAA,MAIA,KAAK,EAAE,UAAF,CAAa,CAAC,GAAd,EAJL;AAAA,MAKA,KAAS,gBALT;AAAA,MAMA,SAAS,CAAC,KAAV,EANA;aAOA,IAAI,CAAC,KAAK,CAAC,eAAX,CAA2B,EAA3B,EAA+B,IAA/B,EAAqC,SAAC,GAAD;AAEnC;AAAA,kBAAU,EAAE,UAAF,CAAa,CAAC,GAAd,EAAV;eACA,WAAW,CAAC,MAAZ,CAAmB;AAAA,UAAC,KAAK,OAAN;SAAnB,EAAmC;AAAA,UAAC,OAAO;AAAA,YAAC,MAAM,GAAP;WAAR;SAAnC,EAAyD;AAEvD,mBAAS,CAAC,IAAV;AAAA,UACA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,sBAA5B,CAAmD,CAAC,IAApD,CAAyD,YAAzD,CAAsE,CAAC,OAAvE,CAA+E,OAA/E,CADA;iBAEA,IAAI,CAAC,MAAL,CAAY,wBAAZ,EAJuD;QAAA,CAAzD,EAHmC;MAAA,CAArC,EARgC;IAAA,CAFE;AAAA,IAmBpC,uBAAuB,SAAC,CAAD;AACrB,UAAG,CAAC,CAAC,cAAL;AAAyB,SAAC,CAAC,cAAF,GAAzB;OAAA;AAAA,MACA,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,QAAnB,CAA4B,QAA5B,CADA;AAEA,aAAO,KAAP,CAHqB;IAAA,CAnBa;AAAA,IAwBpC,wBAAwB,SAAC,CAAD;AACtB,UAAG,CAAC,CAAC,cAAL;AAAyB,SAAC,CAAC,cAAF,GAAzB;OAAA;AAAA,MACA,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,QAAnB,CAA4B,QAA5B,CADA;AAEA,aAAO,KAAP,CAHsB;IAAA,CAxBY;AAAA,IA6BpC,wBAAwB,SAAC,CAAD;AACtB,UAAG,CAAC,CAAC,cAAL;AAAyB,SAAC,CAAC,cAAF,GAAzB;OAAA;AAAA,MACA,EAAE,CAAC,CAAC,aAAJ,CAAkB,CAAC,WAAnB,CAA+B,QAA/B,CADA;AAEA,aAAO,KAAP,CAHsB;IAAA,CA7BY;AAAA,IAkCpC,mBAAmB,SAAC,CAAD;AACjB;AAAA,OAAC,CAAC,cAAF;AAAA,MACA,OAAO,CAAC,GAAR,CAAY,4BAAZ,CADA;AAAA,MAGA,WAAW,KAHX;AAAA,MAIA,UAAU,EAAE,UAAF,CAAa,CAAC,GAAd,EAJV;AAAA,MAKA,SAAS,CAAC,CAAC,aAAa,CAAC,YAAY,CAAC,KAAK,CAAC,MAL5C;AAAA,MAOA,OAAO,CAAC,GAAR,CAAY,MAAZ,CAPA;AAAA,MASA,SAAS,CAAC,KAAV,EATA;AAWA;WAAS,kFAAT;AAEE,eAAO,CAAC,GAAR,CAAY,eAAe,CAAC,IAAI,CAAL,CAAf,GAAyB,WAAzB,GAAuC,MAAnD;AAAA,sBAEA,IAAI,CAAC,KAAK,CAAC,eAAX,CAA2B,OAA3B,EAAoC,CAAC,CAAC,aAAa,CAAC,YAAY,CAAC,KAAM,GAAvE,EAA2E,SAAC,GAAD;iBAEzE,WAAW,CAAC,MAAZ,CAAmB;AAAA,YAAC,KAAK,OAAN;WAAnB,EAAmC;AAAA,YAAC,OAAO;AAAA,cAAC,MAAM,GAAP;aAAR;WAAnC,EAAyD;AAEvD,mBAAO,CAAC,GAAR,CAAY,iBAAiB,GAAjB,GAAuB,YAAnC;AAEA,gBAAG,IAAI,CAAJ,IAAS,MAAZ;AACE,uBAAS,CAAC,IAAV;AAAA,cACA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,sBAA5B,CAAmD,CAAC,IAApD,CAAyD,YAAzD,CAAsE,CAAC,OAAvE,CAA+E,OAA/E,CADA;qBAEA,IAAI,CAAC,MAAL,CAAY,2BAAZ,EAHF;aAJuD;UAAA,CAAzD,EAFyE;QAAA,CAA3E,EAFA,CAFF;AAAA;sBAZiB;IAAA,CAlCiB;AAAA,IA+DpC,0CAA0C,SAAC,CAAD;AACxC;AAAA,gBAAU,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,OAAZ,CAAoB,IAApB,CAAV;AAAA,MACA,KAAK,EAAE,UAAF,CAAa,CAAC,GAAd,EADL;AAAA,MAEA,QAAQ,CAAC,CAAC,IAAF,CAAO,OAAO,CAAC,IAAR,CAAa,MAAb,CAAoB,CAAC,GAArB,CAAyB,kBAAzB,CAA4C,CAAC,KAA7C,CAAmD,GAAnD,CAAP,CAA+D,CAAC,OAAhE,CAAwE,GAAxE,EAA6E,EAA7E,CAFR;AAAA,MAGA,QAAQ,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAiB,GAAjB,GAAsB,SAAtB,GAAkC,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAiB,GAH3D;AAAA,MAIA,OAAO,CAAC,GAAR,CAAY,KAAZ,CAJA;aAKA,MAAM,CAAC,IAAP,CAAY,YAAZ,EAA0B,CAAC,KAAD,EAAQ,KAAR,CAA1B,EAA0C,eAA1C,EAA2D,SAAC,GAAD,EAAM,GAAN;AACzD;AAAA,YAAG,GAAH;iBAEE,IAAI,CAAC,MAAL,CAAY,8CAAZ,EAFF;SAAA;AAME,cAAG,GAAH;AAEE,mBAAO,CAAC,MAAR;AAAA,YACA,SAAS,EADT;AAAA,YAEA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,oBAA5B,CAAiD,CAAC,IAAlD,CAAuD;AAErD;AAAA,kBAAG,EAAC,CAAE,IAAF,CAAO,CAAC,QAAR,CAAiB,yBAAjB,CAAJ;AACE,sBAAM,EAAE,IAAF,CAAO,CAAC,IAAR,CAAa,MAAb,CAAoB,CAAC,GAArB,CAAyB,kBAAzB,CAA4C,CAAC,KAA7C,CAAmD,GAAnD,CAAN;AAAA,gBACA,OAAO,CAAC,CAAC,IAAF,CAAO,GAAP,CAAW,CAAC,OAAZ,CAAoB,GAApB,EAAyB,EAAzB,CADP;AAAA,gBAEA,MAAM,CAAC,CAAC,IAAF,CAAO,IAAI,CAAC,KAAL,CAAW,GAAX,CAAP,CAFN;AAAA,gBAGA,WAAW,CAAC,CAAC,KAAF,CAAQ,IAAI,CAAC,KAAL,CAAW,GAAX,CAAgB,GAAE,CAAC,KAAnB,CAAyB,GAAzB,CAAR,CAHX;uBAIA,MAAM,CAAC,IAAP,CAAY,WAAW,GAAX,GAAiB,GAA7B,EALF;eAFqD;YAAA,CAAvD,CAFA;AAAA,YAUA,WAAW,CAAC,MAAZ,CAAmB,EAAnB,EAAuB;AAAA,cAAC,MAAM;AAAA,gBAAC,QAAQ,MAAT;eAAP;aAAvB,CAVA;mBAWA,IAAI,CAAC,MAAL,CAAY,sBAAZ,EAbF;WAAA;mBAiBE,IAAI,CAAC,MAAL,CAAY,oDAAZ,EAjBF;WANF;SADyD;MAAA,CAA3D,EANwC;IAAA,CA/DN;GAAtC,CA3OA;AAAA,EA6UA,IAAC,QAAD,GAAW;AAAA,IAET,kBAAkB,IAFT;AAAA,IAGT,uBAAuB,IAHd;AAAA,IAKT,kBAAkB;AAEhB;AAAA,cAAQ,GAAR;AAAA,MACA,SAAS,WAAW,CAAC,OAAZ,CAAoB;AAAA,QAAC,OAAO,OAAO,CAAC,GAAR,CAAY,yBAAZ,CAAR;OAApB,CAAoE,CAAC,IAAI,CAAC,MADnF;aAEA,EAAE,YAAF,CAAe,CAAC,IAAhB,CAAqB,qBAArB,CAA2C,CAAC,KAA5C,CAAkD,SAAS,KAA3D,EAJgB;IAAA,CALT;AAAA,IAWT,eAAe;AAEb;AAAA,iBAAW,EAAX;AAAA,MAEA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,UAA5B,CAAuC,CAAC,IAAxC,CAA6C;AAC3C;AAAA,cAAM;AAAA,UACJ,IAAI,EAAE,IAAF,CAAO,CAAC,IAAR,CAAa,IAAb,CADA;AAAA,UAEJ,OAAM,EAAE,IAAF,CAAO,CAAC,KAAR,EAFF;SAAN;eAIA,QAAQ,CAAC,IAAT,CAAc,GAAd,EAL2C;MAAA,CAA7C,CAFA;AAAA,MASA,QAAQ,CAAC,OAAT,CAAiB,SAAC,IAAD;AACf,eAAO,CAAC,GAAR,CAAY,cAAc,IAAI,CAAC,EAA/B;eACA,WAAW,CAAC,MAAZ,CAAmB;AAAA,UAAC,OAAO,IAAI,CAAC,EAAb;SAAnB,EAAqC;AAAA,UAAC,MAAM;AAAA,YAAC,SAAS,IAAI,CAAC,KAAf;WAAP;SAArC,EAFe;MAAA,CAAjB,CATA;aAaA,OAAO,CAAC,GAAR,CAAY,kBAAZ,EAfa;IAAA,CAXN;AAAA,IA4BT,aAAa;AAEX;AAAA,kBAAY,EAAZ;AAAA,MACA,KAAK,EAAE,UAAF,CAAa,CAAC,GAAd,EADL;AAAA,MAGA,EAAE,mBAAF,CAAsB,CAAC,IAAvB,CAA4B,oBAA5B,CAAiD,CAAC,IAAlD,CAAuD;AAErD;AAAA,YAAG,EAAC,CAAE,IAAF,CAAO,CAAC,QAAR,CAAiB,yBAAjB,CAAJ;AACE,gBAAM,EAAE,IAAF,CAAO,CAAC,IAAR,CAAa,MAAb,CAAoB,CAAC,GAArB,CAAyB,kBAAzB,CAA4C,CAAC,KAA7C,CAAmD,GAAnD,CAAN;AAAA,UACA,OAAO,CAAC,CAAC,IAAF,CAAO,GAAP,CAAW,CAAC,OAAZ,CAAoB,GAApB,EAAyB,EAAzB,CAA4B,CAAC,OAA7B,CAAqC,GAArC,EAA0C,EAA1C,CADP;AAAA,UAEA,MAAM,CAAC,CAAC,IAAF,CAAO,IAAI,CAAC,KAAL,CAAW,GAAX,CAAP,CAFN;AAAA,UAGA,WAAW,CAAC,CAAC,KAAF,CAAQ,IAAI,CAAC,KAAL,CAAW,GAAX,CAAgB,GAAE,CAAC,KAAnB,CAAyB,GAAzB,CAAR,CAHX;iBAIA,SAAS,CAAC,IAAV,CAAe,WAAW,GAAX,GAAiB,GAAhC,EALF;SAFqD;MAAA,CAAvD,CAHA;AAAA,MAYA,OAAO,CAAC,GAAR,CAAY,SAAZ,CAZA;AAAA,MAcA,WAAW,CAAC,MAAZ,CAAmB;AAAA,QAAC,KAAK,EAAN;OAAnB,EAA8B;AAAA,QAAC,MAAM;AAAA,UAAC,QAAQ,SAAT;SAAP;OAA9B,EAA2D;eAEzD,EAAE,gBAAF,CAAmB,CAAC,IAApB,CAAyB,eAAe,EAAf,GAAoB,IAA7C,CAAkD,CAAC,OAAnD,CAA2D,OAA3D,EAFyD;MAAA,CAA3D,CAdA;aAkBA,OAAO,CAAC,GAAR,CAAY,WAAZ,EApBW;IAAA,CA5BJ;GA7UX,CAFF;CAAA;;AAqYA,IAAG,MAAM,CAAC,QAAV;AAEE,SAAO,CAAC,GAAR,CAAY,4BAAZ;AAAA,EACA,MAAM,CAAC,OAAP,CAAe,aAAf,EAA8B;WAC5B,WAAW,CAAC,IAAZ,GAD4B;EAAA,CAA9B,CADA;AAiBA,MAAG,WAAW,CAAC,IAAZ,EAAkB,CAAC,KAAnB,OAA8B,CAAjC;AAEE,eAAW,CAAC,MAAZ,CAAmB;AAAA,MAEjB,MAAM,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB,EAA4B,OAA5B,EAAqC,OAArC,CAFW;AAAA,MAGjB,UAAU,OAHO;AAAA,MAIjB,OAAO,YAJU;AAAA,MAKjB,MAAM,4CALW;AAAA,MAMjB,MAAM,IAAI,CAAC,KAAL,CAAe,UAAf,CANW;AAAA,MAOjB,OAAO,CAPU;KAAnB;AAAA,IAWA,WAAW,CAAC,MAAZ,CAAmB;AAAA,MAEjB,MAAM,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,EAA+B,QAA/B,EAAyC,QAAzC,CAFW;AAAA,MAGjB,UAAU,QAHO;AAAA,MAIjB,OAAO,aAJU;AAAA,MAKjB,MAAM,4CALW;AAAA,MAMjB,MAAM,IAAI,CAAC,KAAL,CAAe,UAAf,CANW;AAAA,MAOjB,OAAO,CAPU;KAAnB,CAXA,CAFF;GAnBF;CArYA","file":"/modules/components/gallery/gallery.coffee.js","sourcesContent":["if Meteor.isClient\n\n  console.log 'Aura::Gallery initialized!'\n  Meteor.subscribe 'auraGallery'\n\n  initial = true\n  Tracker.autorun ->\n    console.log 'tracker runned'\n    if AuraGallery.findOne()\n      if initial\n        Session.set 'auraGalleryCurrentAlbum', AuraGallery.findOne()._id\n        initial = false\n\n  Tracker.autorun ->\n    if AuraGallery.findOne()\n      console.log 'tracker 2 runed'\n      Session.set 'auraGalleryCurrentPic', AuraGallery.findOne({'_id': Session.get('auraGalleryCurrentAlbum')}).pics[0]\n#      $.scrollTo('.pic-container', 600, {offset: -70})\n      Gallery.countPreviewTape()\n\n\n  Template.registerHelper 'auraGalleryListAlbums', ->\n    AuraGallery.find({}, {sort: {order: 1}})\n\n  Template.registerHelper 'auraGalleryCurrentAlbum', ->\n    if Session.get('auraGalleryCurrentAlbum')\n      console.log Session.get('auraGalleryCurrentAlbum')\n      AuraGallery.findOne('_id': Session.get('auraGalleryCurrentAlbum'))\n\n\n  Template.registerHelper 'auraGalleryCurrentPic', ->\n    $('<img>').attr('src', 'http://d1tvqt3gjtui5j.cloudfront.net/gallery/' + Session.get('auraGalleryCurrentPic')).on 'load', ->\n      $('.main-pic').find('.spinner-container').removeClass '_visible'\n      $('.pic-container').addClass '_visible'\n    Session.get 'auraGalleryCurrentPic'\n\n  Template.registerHelper 'auraGalleryGetThumb', (pic)->\n    if pic\n      pic.split('.')[0] + '_thumb.' + pic.split('.')[1]\n\n  Template.registerHelper 'getFirstPicThumb', (pics)->\n    pic = _.first pics\n    pic.split('.')[0] + '_thumb.' + pic.split('.')[1]\n\n\n\n\n  Meteor.startup ->\n\n    $('body').on 'click', '[data-gallery-album-target]', (e)->\n      console.log 'changing album'\n      if $(e.currentTarget).data('gallery-album-target') isnt Session.get('auraGalleryCurrentAlbum')\n        target = $(e.currentTarget).data('gallery-album-target')\n        console.log target\n        $('.main-pic').find('.spinner-container').addClass '_visible'\n        $('.pic-container').removeClass '_visible'\n        Session.set('auraGalleryCurrentAlbum', target)\n      else\n        $.scrollTo('.pic-container', 600, {offset: -70})\n\n\n    $('body').on 'click', '[data-gallery-toggle-modal]', ->\n\n      console.log 'gallery admin rendered'\n\n      if Gallery.galleryEditModal\n        $('#galleryEditModal').addClass '_opened'\n      else\n        Gallery.galleryEditModal = Blaze.renderWithData Template.galleryEditModal, {itemList: AuraGallery.find({}, {sort: {order: 1}})} , document.body\n\n    $('body').on 'click', '[data-gallery-pic-target]', (e)->\n      console.log 'changing pic'\n      if $(e.currentTarget).data('gallery-pic-target') isnt Session.get('auraGalleryCurrentPic')\n        target = $(e.currentTarget).data('gallery-pic-target')\n        console.log target\n        $('.main-pic').find('.spinner-container').addClass '_visible'\n        $('.pic-container').removeClass '_visible'\n        Session.set('auraGalleryCurrentPic', target)\n        $(e.currentTarget).addClass('_active').siblings().removeClass '_active'\n\n    $('body').on 'click', '#auraGalleryNextPic', ->\n      length = AuraGallery.findOne('_id': Session.get('auraGalleryCurrentAlbum')).pics.length\n      $('.main-pic').find('.spinner-container').addClass '_visible'\n      $('.pic-container').removeClass '_visible'\n      picIndex = do ->\n        if $('.carousel-container').find('div._active').length > 0\n          index = $('.carousel-container').find('div._active').index()\n          if index + 1 >= length\n            $('.carousel-container').find('div._active').removeClass('_active')\n            $('.carousel-container').find('div').first().addClass('_active')\n            0\n          else\n            index + 1\n            $('.carousel-container').find('div._active').removeClass('_active').next().addClass('_active')\n            $('.carousel-container').find('div._active').index()\n        else\n          $('.carousel-container').find('div').first().next().addClass('_active')\n          1\n      Session.set('auraGalleryCurrentPic', AuraGallery.findOne('_id': Session.get('auraGalleryCurrentAlbum')).pics[picIndex])\n\n    $('body').on 'click', '#auraGalleryPrevPic', ->\n      length = AuraGallery.findOne('_id': Session.get('auraGalleryCurrentAlbum')).pics.length\n      $('.main-pic').find('.spinner-container').addClass '_visible'\n      $('.pic-container').removeClass '_visible'\n      picIndex = do ->\n        if $('.carousel-container').find('div._active').length > 0\n          index = $('.carousel-container').find('div._active').index()\n          if index - 1 < 0\n            $('.carousel-container').find('div._active').removeClass('_active')\n            $('.carousel-container').find('div').last().addClass('_active')\n            $('.carousel-container').find('div').last().index()\n          else\n            index - 1\n            $('.carousel-container').find('div._active').removeClass('_active').prev().addClass('_active')\n            $('.carousel-container').find('div._active').index()\n        else\n          $('.carousel-container').find('div').last().addClass('_active')\n          $('.carousel-container').find('div').last().index()\n      Session.set('auraGalleryCurrentPic', AuraGallery.findOne('_id': Session.get('auraGalleryCurrentAlbum')).pics[picIndex])\n\n\n  Template.galleryEditModal.events {\n\n    'click aside li': (e)->\n      id = $(e.currentTarget).data('id')\n      Session.set 'auraModalList', id\n      $(e.currentTarget).addClass('_active').siblings().removeClass('_active')\n      if Gallery.currentEditModalAlbum\n        Blaze.remove Gallery.currentEditModalAlbum\n      console.log AuraGallery.findOne({_id: id})\n      Gallery.currentEditModalAlbum = Blaze.renderWithData Template.galleryEditModalAlbum, AuraGallery.findOne({_id: id}), $('#galleryEditModal').find('.list-wrap').get(0)\n\n    'click aside li .delete': (e)->\n      clicked = $(e.target).closest('li')\n      id = clicked.data('id')\n      images = AuraGallery.findOne({'_id': id}).pics\n      thumbs = images.map (i)->\n        i.split('.')[0] + '_thumb.' + i.split('.')[1]\n      images = images.concat thumbs\n      order = parseInt clicked.data('order'), 10\n      console.log images\n      (new PNotify({\n        title: 'Удалить целый альбом?',\n        text: 'Все фотографии этого альбома будут удалены с хостинга',\n        hide: false,\n        addclass: 'aura-notify'\n        confirm: {\n          confirm: true\n        },\n        buttons: {\n          closer: false,\n          sticker: false\n        },\n        history: {\n          history: false\n        }\n      })).get().on('pnotify.confirm', ->\n\n        Meteor.call 'deletePics', images, 'ahsl2/gallery', (err, res)->\n          if err\n\n            Aura.notify 'Изображения не удалены:( Может и к лучшему))'\n\n          else\n\n            if res\n\n              AuraGallery.remove id\n              Aura.notify 'Альбом удален!'\n              $(e.target).closest('ul').find('li').first().trigger('click')\n\n              AuraGallery.find({order: {$gt: order}}).fetch().forEach (album)->\n                newOrder = album.order - 1\n                id = album._id\n                AuraGallery.update id, {$set: {order: newOrder}}\n\n            else\n\n              Aura.notify 'Изображения не удалены:( Ошибка на стороне сервера'\n\n      ).on('pnotify.cancel', ->\n        console.log 'deletion canceled'\n      )\n\n\n    'click aside .add-new': (e)->\n\n      AuraGallery.find().fetch().forEach (album)->\n        newOrder = album.order + 1\n        console.log newOrder\n        AuraGallery.update album._id, {$set: {order: newOrder}}\n\n      AuraGallery.insert {\n        order: 0,\n        pics: [],\n        title: 'Новый альбом'\n        desc: 'Описание альбома'\n        date: Date.parse(new Date())\n      }, (id)->\n        Meteor.setTimeout ->\n          $(e.target).siblings('ul').find('li').first().trigger('click')\n        , 300\n\n  }\n\n  Template.galleryEditModal.rendered = ->\n\n    console.log 'rendering gallery admin'\n\n    Meteor.defer ->\n\n      $('#galleryEditModal').addClass '_opened'\n\n      $('#galleryEditModal').find('#gallery-albums-list').sortable({\n        stop: (e, ui)->\n          Gallery.reorderAlbums()\n      })\n\n      $('#galleryEditModal').find('#gallery-albums-list').find('li').first().trigger('click')\n\n\n  Template.galleryEditModalAlbum.rendered = ->\n\n    $(\"#gallery-items-thumbs\").sortable({\n      stop: (e, ui)->\n        Gallery.reorderPics()\n    })\n\n\n  Template.galleryEditModalAlbum.helpers {\n\n    getThumb: (pic)->\n\n      pic.split('.')[0] + '_thumb.' + pic.split('.')[1]\n\n  }\n\n  Template.galleryEditModalAlbum.events {\n\n    'change .add input[type=\"file\"]': (e)->\n      console.log 'triggered change'\n      input = $(e.target)\n      file = input.get(0).files[0]\n      console.log input.get(0).files[0]\n      id = $('#albumId').val()\n      fr = new FileReader()\n      NProgress.start()\n      Aura.media.resizeAndUpload id, file, (res)->\n\n        albumId = $('#albumId').val()\n        AuraGallery.update {_id: albumId}, {$push: {pics: res}}, ->\n\n          NProgress.done()\n          $('#galleryEditModal').find('#gallery-albums-list').find('li._active').trigger('click')\n          Aura.notify 'Изображение добавлено!'\n\n    'dragover .list-cont': (e)->\n      if e.preventDefault then e.preventDefault()\n      $(e.currentTarget).addClass('_hover')\n      return false\n\n    'dragenter .list-cont': (e)->\n      if e.preventDefault then e.preventDefault()\n      $(e.currentTarget).addClass('_hover')\n      return false\n\n    'dragleave .list-cont': (e)->\n      if e.preventDefault then e.preventDefault()\n      $(e.currentTarget).removeClass('_hover')\n      return false\n\n    'drop .list-cont': (e)->\n      e.preventDefault()\n      console.log 'triggering multiple upload'\n\n      uploaded = false\n      albumId = $('#albumId').val()\n      length = e.originalEvent.dataTransfer.files.length\n\n      console.log length\n\n      NProgress.start()\n\n      for i in [0...length]\n\n        console.log 'Загружаем ' + (i + 1) + ' файл из ' + length\n\n        Aura.media.resizeAndUpload albumId, e.originalEvent.dataTransfer.files[i], (res)->\n\n          AuraGallery.update {_id: albumId}, {$push: {pics: res}}, ->\n\n            console.log 'изображение ' + res + ' загружено'\n\n            if i + 1 >= length\n              NProgress.done()\n              $('#galleryEditModal').find('#gallery-albums-list').find('li._active').trigger('click')\n              Aura.notify 'Все изображения загружены'\n\n\n\n    'click #gallery-items-thumbs li .delete': (e)->\n      clicked = $(e.target).closest('li')\n      id = $('#albumId').val()\n      image = _.last(clicked.find('.img').css('background-image').split('/')).replace(')', '')\n      thumb = image.split('.')[0] + '_thumb.' + image.split('.')[1]\n      console.log image\n      Meteor.call 'deletePics', [image, thumb], 'ahsl2/gallery', (err, res)->\n        if err\n\n          Aura.notify 'Изображение не удалено:( Может и к лучшему))'\n\n        else\n\n          if res\n\n            clicked.remove()\n            images = []\n            $('#galleryEditModal').find('.list-cont li.item').each ->\n\n              if !$(this).hasClass('ui-sortable-placeholder')\n                img = $(this).find('.img').css('background-image').split('/')\n                name = _.last(img).replace(')', '')\n                ext = _.last(name.split('.'))\n                origName = _.first(name.split('.')[0].split('_'))\n                images.push(origName + '.' + ext)\n            AuraGallery.update id, {$set: {'pics': images}}\n            Aura.notify 'Изображение удалено!'\n\n          else\n\n            Aura.notify 'Изображение не удалено:( Ошибка на стороне сервера'\n\n  }\n\n\n  @Gallery = {\n\n    galleryEditModal: null\n    currentEditModalAlbum: null\n\n    countPreviewTape: ->\n\n      width = 116\n      length = AuraGallery.findOne({'_id': Session.get('auraGalleryCurrentAlbum')}).pics.length\n      $('.list-pics').find('.carousel-container').width(length * width)\n\n    reorderAlbums: ->\n\n      newOrder = []\n\n      $('#galleryEditModal').find('aside li').each ->\n        obj = {\n          id: $(this).data('id')\n          index:$(this).index()\n        }\n        newOrder.push obj\n\n      newOrder.forEach (item)->\n        console.log 'updating ' + item.id\n        AuraGallery.update {'_id': item.id}, {$set: {'order': item.index}}\n\n      console.log 'albums reordered'\n\n    reorderPics: ->\n\n      reordered = []\n      id = $('#albumId').val()\n\n      $('#galleryEditModal').find('.list-cont li.item').each ->\n\n        if !$(this).hasClass('ui-sortable-placeholder')\n          img = $(this).find('.img').css('background-image').split('/')\n          name = _.last(img).replace(')', '').replace('\"', '')\n          ext = _.last(name.split('.'))\n          origName = _.first(name.split('.')[0].split('_'))\n          reordered.push(origName + '.' + ext)\n\n      console.log reordered\n\n      AuraGallery.update {_id: id}, {$set: {'pics': reordered}}, ->\n\n        $('.carousel-cont').find('[data-id=\"' + id + '\"]').trigger('click')\n\n      console.log 'reordered'\n\n  }\n\n\n\nif Meteor.isServer\n\n  console.log 'Aura::Gallery initialized!'\n  Meteor.publish 'auraGallery', ->\n    AuraGallery.find()\n\n\n\n\n\n\n\n  #Seed\n\n#  if AuraGallery.find().count() > 0\n#\n#    AuraGallery.find().fetch().forEach (a)->\n#      AuraGallery.remove {_id: a._id}\n\n  if AuraGallery.find().count() is 0\n\n    AuraGallery.insert {\n\n      pics: ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg']\n      titlePic: '1.jpg'\n      title: 'Фотосессия'\n      desc: 'Классная фотосессия для маленьких принцесс'\n      date: Date.parse(new Date())\n      order: 1\n\n    }\n\n    AuraGallery.insert {\n\n      pics: ['11.jpg', '12.jpg', '13.jpg', '14.jpg', '15.jpg']\n      titlePic: '11.jpg'\n      title: 'Еще событие'\n      desc: 'Классная фотосессия для маленьких принцесс'\n      date: Date.parse(new Date())\n      order: 2\n\n    }"]}